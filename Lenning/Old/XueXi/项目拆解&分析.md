## 图书后台管理系统项目分析

### 工程需求

在这个工程中使用的图书管理系统，客户需要的是

​	将图书馆中的：

- 图书名

- 图书类别

- 图书作者

- 图书描述

- 图书价格

- 图书库存

  以及备注、借用时间等等

```
通过客户需求的分析可以知道，客户需要的是一种

可以稳定，安全存储大量数据
以及
具有海量数据快速索引和处理能力
并且
操作简单易懂的

数据存储处理平台
```

后续不排除可能会加上数据加密存储，或者其它需求扩展

### 工程需求分析整理 & 功能规划

##### 需求分析 & 整理

*角色*

目前在客户提出的需求中，主要包含以下角色：

- 数据库管理员
- 后端管理员
- 前台（销售人员 或 图书整理人员）
- 消费者（包含借阅者）

根据以上角色不同，得到的登录接口和显示页面也会有所不同：

- 数据库管理员：
  负责整个工程数据存放的位置和安全性，以及在后端管理员需要对数据库进行操作的时候给予对应的API或者反馈；该角色在整个工程中担任非常重要的地位；
- 后端图书管理员：
  为前台提供前台所需要查询的数据反馈，利用后端数据库提供的API或对数据库反馈回来的数据进行处理，调整至前台需要的数据格式，并筛选掉无用无关不安全的数据；
- 前台：
  根据消费者提出的需求，在前端页面上筛选出相对应的产品后，将详情反馈给消费者；

*产品需求*

目前在客户提出的需求中分析到，主要提及到的功能是：

- 数据需要安全存储、能够存储海量数据 并且需要具有容灾能力
- 后续随着业务扩大，数据量增大，不得影响查询速度
- 前端用户不可无限制向后端提交数据操作

需求浅层次解读：确定工程中的角色成员，以及客户对产品的基本需求；

##### 功能规划

在上述工程进一步细化和分析的过程中，该工程涉及到的角色有三种，针对这三种角色，工程应该具备对应的可操作范围、权限和安全性保障规划

- 前台：主要和消费者、前端页面进行交流，确定对方需求以及附加的条件，将这些输入前端页面
- 后端管理员：主要面对接收/回传前端的请求/响应，筛选前端回传的消费者的筛选条件和需求，提交给数据库，并等待结果回传
- 数据库管理员：监控数据库在执行查找语句的时候有没有事务锁和数据查找不到报错等等数据库运行时错误，确保数据库的正常运行状态

上述的所有规划建立在所有角色安全的范围内；可能出现的风险有：

1. 外来入侵风险 => 主要针对数据库或前端页面
2. 客户恶意查询 => 主要针对数据库
3. 角色越权操作 => 主要针对后端和数据库
4. 主机/程序运行崩溃 => 所有设备都存在风险
5. 数据库查询速度过长 => 只有数据库会出现

针对以上必然出现和可能会出现的风险危机，可以设计一些规避方案，例如：

1. 在数据库端
   1. 为数据增加加密存储；
   2. 定期备份数据，进行远端存储；
   3. 修改数据库默认端口；
   4. 删除无用的用户；
   5. 将包括root在内的所有用户设置为仅固定主机可登录；
   6. 定时修改用户密码；
   7. 定期查看数据库运行日志，并进行备份；
2. 在后端
   1. 对前端传输过来的数据进行筛查，是否包含特殊字符*&/^\%|$#'()";,.
   2. 对数据库进行操作（主要是删改）的时候添加确认步骤；
   3. 将危险方法、容易被爆的方法包装运行（不可直接调用的）；
3. 在前端
   1. 前台对用户的条件进行整合之后，尽量少次数的发送给后端，避免资源浪费；
   2. 对用户所输入的条件进行筛查和检索，不得包含特殊字符*&/^\%|$#'()";,.
   3. 关闭前端无必要的对外服务端口，并且主机禁ping；

并且各个角色之间不可互相另外通信，如若有业务上的变更，请联系我们进行调整。

### 需求实现

目前对客户方的需求进行梳理；使用的Nodejs + Express + Mysql的环境部署项目； 

##### 工程文件分析

在这个工程运行中涉及到的文件为：

```
./
package.json  // 生产、安装环境使用的包
app.js  // 主文件


bin  // 运行目录
bin/www // 运行文件

db  // 数据库链接文件
db/bookstore.sql  // 数据库备份文件
db/db.js  // 创建并控制数据库运行接口
db/db_config.js  // 数据库配置信息

public  // 服务器资源

routes  // 路由文件
routes/index.js  // 挂载后端服务访问接口
routes/users.js  // 服务运行接口持续监听

screenshot  // md文件使用到的图片

service  // 路由函数处理模块
service/bookService.js  // 路由上挂载的处理函数(crud)
service/userService.js  // 用户登录&登出处理函数

views  // 前端模板
```

数据库详情：

Mysql数据库结构：bookstart（数据库）=》book（数据表）
																=》user（用户表）

book table:

| Field     | Type         | Null | Key  | Default | Extra          |
| --------- | ------------ | ---- | ---- | ------- | -------------- |
| book_id   | int(11)      | NO   | PRI  | NULL    | auto_increment |
| book_name | varchar(50)  | YES  |      | NULL    |                |
| author    | varchar(20)  | YES  |      | NULL    |                |
| publish   | varchar(50)  | YES  |      | NULL    |                |
| category  | varchar(20)  | YES  |      | NULL    |                |
| book_desc | varchar(255) | YES  |      | NULL    |                |

user table:

| Field       | Type        | Null | Key  | Default | Extra          |
| ----------- | ----------- | ---- | ---- | ------- | -------------- |
| user_id     | int(11)     | NO   | PRI  | NULL    | auto_increment |
| username    | varchar(20) | NO   |      | NULL    |                |
| password    | varchar(16) | YES  |      | NULL    |                |
| phone       | varchar(11) | YES  |      | NULL    |                |
| user_status | varchar(1)  | YES  |      | NULL    |                |



## 工程实现后梳理 & 分析

目前看该工程：
已实现功能：

1. 在前端能渲染出数据库的数据
2. 有针对消费者提出条件进行筛选的功能
3. 有对已有数据crud的功能
4. 有用户登录，验证身份的步骤

未实现功能：

1. 没有进行角色间的分隔
2. 没有做好用户管理
3. 前端对筛选条件进行特殊字符判定
4. 后端没有对前端回传的特殊字符进行判定
5. 数据库没有针对大量数据的查找性能优化
6. 数据库基本配置没有进行修改，存在安全隐患
7. 前端页面没有对恶意攻击和查询的防护手段

缺点：

1. 存在明显的反射型和存储型XSS注入
2. 数据库体量庞大时查询速度缓慢，会导致网页响应超时
3. 数据库没有加密存储用户名和密码这些数据，并且前后端都没有限制用户名不可重复以及密码强度
4. 数据库端口和IP直接暴露在外，账号密码也在一起；
5. 数据库本身没有防止脏读和事务所的操作或设置；
6. 前端页面没有禁ping设置，也没有访问锁；

## 工程总结

在我看来，我觉得这个工程做的不是很满意；对于客户提出的要求和功能需求没有完成，并且有很大的安全漏洞，非常危险