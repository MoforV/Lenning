## coffce 工程规划书

### 一：明确工程目标 & 需求

在整个工程开始之前，需要明确这个工程需要完成什么功能，
明确了需求之后，才能因地制宜的选择开发的框架和方法；

现在我得到的客户提供给我的需求就是：

```
做一个咖啡厅项目，要求能完成标准业务的闭环（从点单到结单），额外要求理解如何对其进行二次开发。
```

在我的理解看来，这句话的解读应该是：

1. 以实际生产环境为主体，开发一个能够满足实际生产需求的系统；
   （经过对市面上已有的产品进行调研，具体需求如下）
   1. 需要有能够确认对应门店的选项卡（获取终端定位）；
   2. 首页/商品一览/商品详情页/购物车；
   3. 订单确认/支付页；
   4. 订单进展/订单售后服务页；
   5. 用户详情/钱包卡包查询/历史订单查询；
   6. 客服热线；
2. 需要熟悉整个工程体系结构；以便后续完成对工程的二次开发；

以上是我对该工程的需求解读；整理好需求之后，分类角色：

1. 前端页面由前端人员根据需求构思

2. 后端需要向前端传输需要渲染的数据，如：

   1. 商品数据

      1. 首页、商品一览、商品详情购物车、订单确认、支付页、订单进展、订单售后和历史订单查询
         - 都需要使用到coffee的商品信息主要包括：名字，价格，商品描述(等)数据
      2. 购物车、订单确认、支付页、订单进展、订单售后和历史订单查询
         - 这六类角色除开上述商品数据，还需额外的添加：商品选中状态、<u>用户公开信息</u>、订单完成状态、<u>该用户点单历史信息及其详情</u>

   2. 用户信息

      1. 购物车、订单确认、支付页、订单进展、订单售后、用户详情、钱包卡包、历史订单
         - 以上这些都会使用到用户的公开信息：昵称、头像、性别、年龄、生日(等)；
      2. 支付页、用户详情、钱包卡包、历史订单
         - 这三类额外需要用户的隐私信息，比如uid、钱包余额、用户支付方式、用户点单内容(等)
      3. 其中**支付页**、**钱包卡包**为非常重要的功能设计，因涉及到资金流动，所以需要非常安全的处理和存储方式

      

### 二：确认角色 & 功能

上文将需求剥离出来之后，下一步就是确定角色，每个角色所需要实现的功能是什么，在上文需求划分中，可将需求按照服务群体类别划分为三种角色，并确定对应功能：

1. 商品
   - 该角色负责商品的数据存储和(来自前端的)商品内容请求处理；
2. 用户
   - 该角色负责用户的基本信息存储，安全性信息(包含钱包卡包、敏感信息)存储；
3. 订单
   - 该角色需跟进正在进行的订单，未进行的订单，支付失败的订单和已完成的订单，以及与之关联的用户；



### 三：工程规划 & 功能规划

确定角色和需要实现的功能后，即可进行工程规划，将规划好的功能和角色实现：

规划步骤：

1. 首先实现数据存储方案

   - 数据存储可分为三大类：商品，用户，订单
     这三大类可以分别存储在统一数据库不同数据表中，也可以存储在不同数据库中(推荐)；

     - "商品"包含：商品序列、商品名、价格、描述，实物图片，类别，这些字段
       非空字段有：商品序列(自增, Primary key, Foreign key)、商品名(Foreign key)、价格

       
       
- "用户"包含：昵称、性别、年龄、生日、标签、个签、喜好等公开信息
       非空字段有：昵称(Primary key)
   
  还需另一张表来存储一些敏感信息，该表需要经过一些特殊(例如加密存储)等处理：
       字段为：uid、昵称、联系电话、快件地址、钱包类型、钱包余额、卡包、券包、积分余额，等
非空字段有：uid(Primary key, Foreign key)、昵称(Foreign key)
       
  
  
     - "订单"包含：订单id、uid、商品序列组(字符)、下单时间、支付方式、订单交付状态、订单结束时间
       以上字段均为非空字段；订单id(自增, Primary key)、uid(Foreign key)
  
2. 数据库向后端提供服务 & 数据

   - 为了保证数据的安全性，传输过程中应使用一种双方约定的加密方式；
     例如：MD5加密指定随机盐加密需要发送的字段
     且，后端返回给前端的数据一定要精简，不可以包含任何可能会泄露存储的数据的信息；
   - 后端与数据库之间的传输通道也需要加密，协同数据库的加密存储；
     且，数据库用户限制远程登陆和指定主机远程登陆，指定只能后端主机组能够对数据库进行操作；

3. 前端和后端的信息数据交互

   - 在与后端进行对接的时候，多使用安全请求方式，如Get；若需要传输信息，可以在Get中挟带键值(经过加密后传输)
   - 调用方法时需要有点击延迟锁，不可以让用户短时间多次重复提交，浪费后端处理资源；

4. 前端设计

   - 为保证用户在浏览和点单的时候不会出现占用程序资源太多的情况，前端可以设置长连接和超时断联；
     保证正在使用的用户服务质量的同时，最大化资源利用率
   - 禁ping防DDOS

上述功能可根据实际情况进行删减

### 四：环境规划和功能实现

根据实际环境和客户实际需求，我选择了以下三种部署环境，以满足客户需求

